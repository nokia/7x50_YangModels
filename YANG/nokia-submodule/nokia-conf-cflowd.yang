submodule nokia-conf-cflowd {

    yang-version "1.1";

    belongs-to nokia-conf { prefix "conf"; }

    import nokia-sros-yang-extensions     { prefix "sros-ext"; }
    import nokia-types-cflowd             { prefix "types-cflowd"; }
    import nokia-types-qos                { prefix "types-qos"; }
    import nokia-types-sros               { prefix "types-sros"; }

    include nokia-conf-groups;
    include nokia-conf-router;
    include nokia-conf-service;
    include nokia-conf-svc-ies;
    include nokia-conf-svc-ies-sub-if;
    include nokia-conf-svc-vprn;
    include nokia-conf-svc-vprn-sub-if;

    sros-ext:sros-major-release "rel23";
    organization "Nokia";
    contact
        "Nokia SR OS Support
         Web: <http://www.nokia.com>";
    description
        "Nokia YANG Data model to configure Cflowd configuration on SR OS based routers.

         Copyright 2016 Nokia. All rights reserved. Reproduction of this document
         is authorized on the condition that the foregoing copyright notice is included.

         This nokia-conf-cflowd YANG module embodies Nokia's proprietary
         intellectual property. Nokia retains all title and ownership in the
         specification, including any revisions.

         Nokia grants all interested parties a non-exclusive license to use
         and distribute an unmodified copy of this specification in connection with
         management of Nokia products, and without fee, provided this
         copyright notice and license appear on all copies.

         This specification is supplied `as is', and Nokia makes no warranty,
         either express or implied, as to the use, operation, condition, or performance
         of the specification.";
    revision "2023-03-31";

    grouping conf-cflowd {
        ///nokia-conf/configure/cflowd
        container cflowd {
            presence "Enable the cflowd context";
            description "Enable the cflowd context";

            ///nokia-conf/configure/cflowd/active-timeout
            leaf active-timeout {
                status obsolete;
                type uint32 {
                    range "1..600";
                }
                units "minutes";
                default "30";
                description "Maximum time before an active flow is exported";
            }

            ///nokia-conf/configure/cflowd/admin-state
            leaf admin-state {
                type types-sros:admin-state;
                default "enable";
                description "Administrative state of cflowd";
            }

            ///nokia-conf/configure/cflowd/analyze-gre-payload
            leaf analyze-gre-payload {
                type boolean;
                default "false";
                description "Perform cflowd analysis on the inner IP packet";
            }

            ///nokia-conf/configure/cflowd/analyze-l2tp-traffic
            leaf analyze-l2tp-traffic {
                type boolean;
                default "false";
                description "Analyze the inner IP header of an L2TP packet";
            }

            ///nokia-conf/configure/cflowd/analyze-v4overv6-traffic
            leaf analyze-v4overv6-traffic {
                type boolean;
                default "false";
                description "Analyze the inner IPv4 packet within an IPv6 packet";
            }

            ///nokia-conf/configure/cflowd/cache-size
            leaf cache-size {
                type uint32 {
                    range "1000..2000000";
                }
                units "flows";
                description "Maximum number of active flows in the flow cache table";
            }

            ///nokia-conf/configure/cflowd/enhanced-distribution
            leaf enhanced-distribution {
                type boolean;
                default "false";
                description "Include ingress port ID in hashing algorithm for cflowd";
            }

            ///nokia-conf/configure/cflowd/export-mode
            leaf export-mode {
                type enumeration {
                    enum automatic                      { value 1; }
                    enum manual                         { value 2; }
                }
                default "automatic";
                description "Export mode for flow data";
            }

            ///nokia-conf/configure/cflowd/inactive-timeout
            leaf inactive-timeout {
                status obsolete;
                type uint32 {
                    range "10..600";
                }
                units "seconds";
                default "15";
                description "Time before the flow is considered inactive";
            }

            ///nokia-conf/configure/cflowd/inband-collector-export-only
            leaf inband-collector-export-only {
                type boolean;
                default "false";
                description "Export the traffic to all collectors only via in-band interfaces";
            }

            ///nokia-conf/configure/cflowd/overflow
            leaf overflow {
                type uint32 {
                    range "1..50";
                }
                units "percent";
                default "1";
                description "Percentage of entries to remove from Cflowd cache when the maximum number of entries is exceeded";
            }

            ///nokia-conf/configure/cflowd/rate
            leaf rate {
                status obsolete;
                type uint32 {
                    range "1..10000";
                }
                units "packets";
                default "1000";
                description "Rate at which traffic is sampled and sent for Cflowd analysis";
            }

            ///nokia-conf/configure/cflowd/template-retransmit
            leaf template-retransmit {
                type uint32 {
                    range "10..600";
                }
                units "seconds";
                default "600";
                description "Time to resend template information";
            }

            ///nokia-conf/configure/cflowd/use-vrtr-if-index
            leaf use-vrtr-if-index {
                type boolean;
                default "false";
                description "Export flow data using virtual router interface indexes";
            }

            ///nokia-conf/configure/cflowd/active-flow-timeout
            leaf active-flow-timeout {
                type uint32 {
                    range "30..36000";
                }
                units "seconds";
                default "1800";
                description "Maximum time before an active flow is exported";
            }

            ///nokia-conf/configure/cflowd/inactive-flow-timeout
            leaf inactive-flow-timeout {
                type uint32 {
                    range "10..600";
                }
                units "seconds";
                default "15";
                description "Time without matching packet before flow is inactive";
            }

            ///nokia-conf/configure/cflowd/apply-groups
            leaf-list apply-groups {
                type leafref {
                    path "../../groups/group/name";
                }
                max-elements 8;
                ordered-by user;
                description "Apply a configuration group at this level";
            }

            ///nokia-conf/configure/cflowd/apply-groups-exclude
            leaf-list apply-groups-exclude {
                type leafref {
                    path "../../groups/group/name";
                }
                max-elements 8;
                ordered-by user;
                description "Exclude a configuration group at this level";
            }

            ///nokia-conf/configure/cflowd/sample-profile
            list sample-profile {
                key "profile-id";
                max-elements 5;
                description "Enter the sample-profile list instance";

                ///nokia-conf/configure/cflowd/sample-profile/profile-id
                leaf profile-id {
                    type uint32 {
                        range "1..5";
                    }
                    description "The unique specifier of this sample-profile";
                }

                ///nokia-conf/configure/cflowd/sample-profile/sample-rate
                leaf sample-rate {
                    type uint32 {
                        range "1..60000";
                    }
                    default "1000";
                    description "Cflowd sampling rate for sample profile ID";
                }

                ///nokia-conf/configure/cflowd/sample-profile/metering-process
                leaf metering-process {
                    type types-cflowd:metering-process;
                    default "standard";
                    description "Metering process for samples taken";
                }

                ///nokia-conf/configure/cflowd/sample-profile/slice-selection
                leaf slice-selection {
                    type types-cflowd:slice-selection;
                    default "standard";
                    description "Cflowd sample slice selection for sample profile ID";
                }

                ///nokia-conf/configure/cflowd/sample-profile/apply-groups
                leaf-list apply-groups {
                    type leafref {
                        path "../../../groups/group/name";
                    }
                    max-elements 8;
                    ordered-by user;
                    description "Apply a configuration group at this level";
                }

                ///nokia-conf/configure/cflowd/sample-profile/apply-groups-exclude
                leaf-list apply-groups-exclude {
                    type leafref {
                        path "../../../groups/group/name";
                    }
                    max-elements 8;
                    ordered-by user;
                    description "Exclude a configuration group at this level";
                }

            } // list sample-profile

            ///nokia-conf/configure/cflowd/collector
            list collector {
                key "ip-address port";
                max-elements 8;
                description "Enter the collector list instance";

                ///nokia-conf/configure/cflowd/collector/ip-address
                leaf ip-address {
                    type types-sros:ip-unicast-address;
                    description "IP address of the remote cflowd collector host";
                }

                ///nokia-conf/configure/cflowd/collector/port
                leaf port {
                    type types-qos:tcp-udp-match-port {
                        range "1..65535";
                    }
                    description "UDP port number of the remote cflowd collector host";
                }

                ///nokia-conf/configure/cflowd/collector/admin-state
                leaf admin-state {
                    type types-sros:admin-state;
                    default "enable";
                    description "Administrative state of the cflowd collector";
                }

                ///nokia-conf/configure/cflowd/collector/autonomous-system-type
                leaf autonomous-system-type {
                    type enumeration {
                        enum origin                         { value 1; }
                        enum peer                           { value 2; }
                    }
                    default "origin";
                    description "Basis of the AS information included in flow data";
                }

                ///nokia-conf/configure/cflowd/collector/description
                leaf description {
                    type types-sros:description;
                    description "Text description";
                }

                ///nokia-conf/configure/cflowd/collector/router-instance
                leaf router-instance {
                    type string;
                    default "management";
                    description "Router or service name";
                }

                ///nokia-conf/configure/cflowd/collector/template-set
                leaf template-set {
                    type enumeration {
                        enum not-applicable                 { value 0; }
                        enum basic                          { value 1; }
                        enum mpls-ip                        { value 2; }
                        enum l2-ip                          { value 3; }
                        enum mpls-transport                 { value 4; }
                        enum compact                        { value 5; }
                        enum fastpath                       { value 6; }
                    }
                    description "Templates sent to the collector";
                }

                ///nokia-conf/configure/cflowd/collector/version
                leaf version {
                    type types-cflowd:collector-version;
                    sros-ext:immutable;
                    mandatory true;
                    description "Flow data collector version";
                }

                ///nokia-conf/configure/cflowd/collector/apply-groups
                leaf-list apply-groups {
                    type leafref {
                        path "../../../groups/group/name";
                    }
                    max-elements 8;
                    ordered-by user;
                    description "Apply a configuration group at this level";
                }

                ///nokia-conf/configure/cflowd/collector/apply-groups-exclude
                leaf-list apply-groups-exclude {
                    type leafref {
                        path "../../../groups/group/name";
                    }
                    max-elements 8;
                    ordered-by user;
                    description "Exclude a configuration group at this level";
                }

                ///nokia-conf/configure/cflowd/collector/aggregation
                container aggregation {
                    description "Enter the aggregation context";

                    ///nokia-conf/configure/cflowd/collector/aggregation/as-matrix
                    leaf as-matrix {
                        type boolean;
                        default "false";
                        description "Base aggregation data based on AS information";
                    }

                    ///nokia-conf/configure/cflowd/collector/aggregation/protocol-port
                    leaf protocol-port {
                        type boolean;
                        default "false";
                        description "Aggregate flows based on the IP protocol and ports";
                    }

                    ///nokia-conf/configure/cflowd/collector/aggregation/source-prefix
                    leaf source-prefix {
                        type boolean;
                        default "false";
                        description "Aggregate flows based on the source prefix information";
                    }

                    ///nokia-conf/configure/cflowd/collector/aggregation/destination-prefix
                    leaf destination-prefix {
                        type boolean;
                        default "false";
                        description "Aggregate data based on destination prefix information";
                    }

                    ///nokia-conf/configure/cflowd/collector/aggregation/source-destination-prefix
                    leaf source-destination-prefix {
                        type boolean;
                        default "false";
                        description "Aggregate data based on prefix information";
                    }

                    ///nokia-conf/configure/cflowd/collector/aggregation/raw
                    leaf raw {
                        type boolean;
                        default "false";
                        description "Export flow data without aggregation";
                    }

                } // container aggregation

                ///nokia-conf/configure/cflowd/collector/export-filter
                container export-filter {
                    when "../version = 9 or ../version = 10" {
                        description "export-filter can only be configured for collector versions 9 or 10";
                    }
                    description "Enter the export-filter context";

                    ///nokia-conf/configure/cflowd/collector/export-filter/family
                    container family {
                        description "Enter the family context";

                        ///nokia-conf/configure/cflowd/collector/export-filter/family/ipv4
                        leaf ipv4 {
                            type boolean;
                            default "false";
                            description "Filter IPv4 flow data from being sent to the collector";
                        }

                        ///nokia-conf/configure/cflowd/collector/export-filter/family/ipv6
                        leaf ipv6 {
                            type boolean;
                            default "false";
                            description "Filter IPv6 flow data from being sent to the collector";
                        }

                        ///nokia-conf/configure/cflowd/collector/export-filter/family/mcast-ipv4
                        leaf mcast-ipv4 {
                            type boolean;
                            default "false";
                            description "Filter multicast IPv4 data from going to the collector";
                        }

                        ///nokia-conf/configure/cflowd/collector/export-filter/family/mcast-ipv6
                        leaf mcast-ipv6 {
                            type boolean;
                            default "false";
                            description "Filter multicast IPv6 data from going to the collector";
                        }

                        ///nokia-conf/configure/cflowd/collector/export-filter/family/l2-ip
                        leaf l2-ip {
                            type boolean;
                            default "false";
                            description "Filter L2 IP flow data from being sent to the collector";
                        }

                        ///nokia-conf/configure/cflowd/collector/export-filter/family/mpls
                        leaf mpls {
                            type boolean;
                            default "false";
                            description "Filter MPLS flow data from being sent to the collector";
                        }

                    } // container family

                    ///nokia-conf/configure/cflowd/collector/export-filter/router
                    list router {
                        key "router-instance";
                        description "Add a list entry for router";

                        ///nokia-conf/configure/cflowd/collector/export-filter/router/router-instance
                        leaf router-instance {
                            type string;
                            description "Router instance name";
                        }

                    } // list router

                    ///nokia-conf/configure/cflowd/collector/export-filter/interface-list
                    container interface-list {
                        description "Enter the interface-list context";

                        ///nokia-conf/configure/cflowd/collector/export-filter/interface-list/router
                        list router {
                            key "router-name interface-name";
                            description "Enter the router list instance";

                            ///nokia-conf/configure/cflowd/collector/export-filter/interface-list/router/router-name
                            leaf router-name {
                                type leafref {
                                    path "../../../../../../router/router-name";
                                }
                                description "Administrative router name";
                            }

                            ///nokia-conf/configure/cflowd/collector/export-filter/interface-list/router/interface-name
                            leaf interface-name {
                                type leafref {
                                    path "../../../../../../router[router-name=current()/../router-name]/interface/interface-name";
                                }
                                description "Name for the router to the service interface or SAP";
                            }

                            ///nokia-conf/configure/cflowd/collector/export-filter/interface-list/router/apply-groups
                            leaf-list apply-groups {
                                type leafref {
                                    path "../../../../../../groups/group/name";
                                }
                                max-elements 8;
                                ordered-by user;
                                description "Apply a configuration group at this level";
                            }

                            ///nokia-conf/configure/cflowd/collector/export-filter/interface-list/router/apply-groups-exclude
                            leaf-list apply-groups-exclude {
                                type leafref {
                                    path "../../../../../../groups/group/name";
                                }
                                max-elements 8;
                                ordered-by user;
                                description "Exclude a configuration group at this level";
                            }

                        } // list router

                        ///nokia-conf/configure/cflowd/collector/export-filter/interface-list/service
                        container service {
                            description "Enter the service context";

                            ///nokia-conf/configure/cflowd/collector/export-filter/interface-list/service/ies-interface
                            list ies-interface {
                                key "service-name interface-name";
                                description "Enter the ies-interface list instance";

                                ///nokia-conf/configure/cflowd/collector/export-filter/interface-list/service/ies-interface/service-name
                                leaf service-name {
                                    type leafref {
                                        path "../../../../../../../service/ies/service-name";
                                    }
                                    description "Administrative service name";
                                }

                                ///nokia-conf/configure/cflowd/collector/export-filter/interface-list/service/ies-interface/interface-name
                                leaf interface-name {
                                    type leafref {
                                        path "../../../../../../../service/ies[service-name=current()/../service-name]/interface/interface-name";
                                    }
                                    description "IP interface name";
                                }

                                ///nokia-conf/configure/cflowd/collector/export-filter/interface-list/service/ies-interface/apply-groups
                                leaf-list apply-groups {
                                    type leafref {
                                        path "../../../../../../../groups/group/name";
                                    }
                                    max-elements 8;
                                    ordered-by user;
                                    description "Apply a configuration group at this level";
                                }

                                ///nokia-conf/configure/cflowd/collector/export-filter/interface-list/service/ies-interface/apply-groups-exclude
                                leaf-list apply-groups-exclude {
                                    type leafref {
                                        path "../../../../../../../groups/group/name";
                                    }
                                    max-elements 8;
                                    ordered-by user;
                                    description "Exclude a configuration group at this level";
                                }

                            } // list ies-interface

                            ///nokia-conf/configure/cflowd/collector/export-filter/interface-list/service/ies-group-interface
                            list ies-group-interface {
                                key "service-name subscriber-interface-name group-interface-name";
                                description "Enter the ies-group-interface list instance";

                                ///nokia-conf/configure/cflowd/collector/export-filter/interface-list/service/ies-group-interface/service-name
                                leaf service-name {
                                    type leafref {
                                        path "../../../../../../../service/ies/service-name";
                                    }
                                    description "Administrative service name";
                                }

                                ///nokia-conf/configure/cflowd/collector/export-filter/interface-list/service/ies-group-interface/subscriber-interface-name
                                leaf subscriber-interface-name {
                                    type leafref {
                                        path "../../../../../../../service/ies[service-name=current()/../service-name]/subscriber-interface/interface-name";
                                    }
                                    description "Subscriber interface name";
                                }

                                ///nokia-conf/configure/cflowd/collector/export-filter/interface-list/service/ies-group-interface/group-interface-name
                                leaf group-interface-name {
                                    type leafref {
                                        path "../../../../../../../service/ies[service-name=current()/../service-name]/subscriber-interface[interface-name=current()/../subscriber-interface-name]/group-interface/group-interface-name";
                                    }
                                    description "Group interface name";
                                }

                                ///nokia-conf/configure/cflowd/collector/export-filter/interface-list/service/ies-group-interface/apply-groups
                                leaf-list apply-groups {
                                    type leafref {
                                        path "../../../../../../../groups/group/name";
                                    }
                                    max-elements 8;
                                    ordered-by user;
                                    description "Apply a configuration group at this level";
                                }

                                ///nokia-conf/configure/cflowd/collector/export-filter/interface-list/service/ies-group-interface/apply-groups-exclude
                                leaf-list apply-groups-exclude {
                                    type leafref {
                                        path "../../../../../../../groups/group/name";
                                    }
                                    max-elements 8;
                                    ordered-by user;
                                    description "Exclude a configuration group at this level";
                                }

                            } // list ies-group-interface

                            ///nokia-conf/configure/cflowd/collector/export-filter/interface-list/service/vprn-interface
                            list vprn-interface {
                                key "service-name interface-name";
                                description "Enter the vprn-interface list instance";

                                ///nokia-conf/configure/cflowd/collector/export-filter/interface-list/service/vprn-interface/service-name
                                leaf service-name {
                                    type leafref {
                                        path "../../../../../../../service/vprn/service-name";
                                    }
                                    description "Administrative service name";
                                }

                                ///nokia-conf/configure/cflowd/collector/export-filter/interface-list/service/vprn-interface/interface-name
                                leaf interface-name {
                                    type leafref {
                                        path "../../../../../../../service/vprn[service-name=current()/../service-name]/interface/interface-name";
                                    }
                                    description "IP interface name";
                                }

                                ///nokia-conf/configure/cflowd/collector/export-filter/interface-list/service/vprn-interface/apply-groups
                                leaf-list apply-groups {
                                    type leafref {
                                        path "../../../../../../../groups/group/name";
                                    }
                                    max-elements 8;
                                    ordered-by user;
                                    description "Apply a configuration group at this level";
                                }

                                ///nokia-conf/configure/cflowd/collector/export-filter/interface-list/service/vprn-interface/apply-groups-exclude
                                leaf-list apply-groups-exclude {
                                    type leafref {
                                        path "../../../../../../../groups/group/name";
                                    }
                                    max-elements 8;
                                    ordered-by user;
                                    description "Exclude a configuration group at this level";
                                }

                            } // list vprn-interface

                            ///nokia-conf/configure/cflowd/collector/export-filter/interface-list/service/vprn-network-interface
                            list vprn-network-interface {
                                key "service-name network-interface-name";
                                description "Enter the vprn-network-interface list instance";

                                ///nokia-conf/configure/cflowd/collector/export-filter/interface-list/service/vprn-network-interface/service-name
                                leaf service-name {
                                    type leafref {
                                        path "../../../../../../../service/vprn/service-name";
                                    }
                                    description "Administrative service name";
                                }

                                ///nokia-conf/configure/cflowd/collector/export-filter/interface-list/service/vprn-network-interface/network-interface-name
                                leaf network-interface-name {
                                    type leafref {
                                        path "../../../../../../../service/vprn[service-name=current()/../service-name]/network-interface/interface-name";
                                    }
                                    description "Network interface name";
                                }

                                ///nokia-conf/configure/cflowd/collector/export-filter/interface-list/service/vprn-network-interface/apply-groups
                                leaf-list apply-groups {
                                    type leafref {
                                        path "../../../../../../../groups/group/name";
                                    }
                                    max-elements 8;
                                    ordered-by user;
                                    description "Apply a configuration group at this level";
                                }

                                ///nokia-conf/configure/cflowd/collector/export-filter/interface-list/service/vprn-network-interface/apply-groups-exclude
                                leaf-list apply-groups-exclude {
                                    type leafref {
                                        path "../../../../../../../groups/group/name";
                                    }
                                    max-elements 8;
                                    ordered-by user;
                                    description "Exclude a configuration group at this level";
                                }

                            } // list vprn-network-interface

                            ///nokia-conf/configure/cflowd/collector/export-filter/interface-list/service/vprn-group-interface
                            list vprn-group-interface {
                                key "service-name subscriber-interface-name group-interface-name";
                                description "Enter the vprn-group-interface list instance";

                                ///nokia-conf/configure/cflowd/collector/export-filter/interface-list/service/vprn-group-interface/service-name
                                leaf service-name {
                                    type leafref {
                                        path "../../../../../../../service/vprn/service-name";
                                    }
                                    description "Administrative service name";
                                }

                                ///nokia-conf/configure/cflowd/collector/export-filter/interface-list/service/vprn-group-interface/subscriber-interface-name
                                leaf subscriber-interface-name {
                                    type leafref {
                                        path "../../../../../../../service/vprn[service-name=current()/../service-name]/subscriber-interface/interface-name";
                                    }
                                    description "Subscriber interface name";
                                }

                                ///nokia-conf/configure/cflowd/collector/export-filter/interface-list/service/vprn-group-interface/group-interface-name
                                leaf group-interface-name {
                                    type leafref {
                                        path "../../../../../../../service/vprn[service-name=current()/../service-name]/subscriber-interface[interface-name=current()/../subscriber-interface-name]/group-interface/group-interface-name";
                                    }
                                    description "Group interface name";
                                }

                                ///nokia-conf/configure/cflowd/collector/export-filter/interface-list/service/vprn-group-interface/apply-groups
                                leaf-list apply-groups {
                                    type leafref {
                                        path "../../../../../../../groups/group/name";
                                    }
                                    max-elements 8;
                                    ordered-by user;
                                    description "Apply a configuration group at this level";
                                }

                                ///nokia-conf/configure/cflowd/collector/export-filter/interface-list/service/vprn-group-interface/apply-groups-exclude
                                leaf-list apply-groups-exclude {
                                    type leafref {
                                        path "../../../../../../../groups/group/name";
                                    }
                                    max-elements 8;
                                    ordered-by user;
                                    description "Exclude a configuration group at this level";
                                }

                            } // list vprn-group-interface

                        } // container service

                    } // container interface-list

                } // container export-filter

            } // list collector

        } // container cflowd

    } // grouping conf-cflowd

}
